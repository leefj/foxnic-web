<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<script type="text/javascript" src="/assets/libs/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="/assets/libs/3d/three.js" ></script>
		<script type="text/javascript" src="/assets/libs/3d/TrackballControls.js" ></script>
		<script type="text/javascript" src="/assets/libs/3d/DDSLoader.js" ></script>
		<script type="text/javascript" src="/assets/libs/3d/OBJLoader.js" ></script>
		<script type="text/javascript" src="/assets/libs/3d/OBJMTLLoader.js" ></script>
		<title></title>
	</head>
	<style>
		body{
			margin: 0;
			overflow: hidden;
		}
		#percent {
		    position: absolute;
		    width: 200px;
		    height: 20px;
		    color: red;
		    text-align: center;
		    border: 1p;
		}
	</style>
	<body>
	
		<div id="percent"></div>
		<div id="WebGL-output">
		</div>
		
		<script>
		 
		window.render = function(objUrl) {
				//直接开启帧数检测
				//编辑代码处
				var scene = new THREE.Scene();//场景构建
				var camera = new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,0.1,1000);//相机构建
				var renderer = new THREE.WebGLRenderer();//渲染器构建
				//设置场景颜色
				renderer.setClearColor(0xEEEEEE);
				renderer.setSize(window.innerWidth,window.innerHeight);
				renderer.shadowMapEnabled = true;//激活阴影
				//构建一个坐标轴
				var axes = new THREE.AxisHelper(20);
				//scene.add(axes);
				//创建控件并绑定在相机上
				trackballControls = new THREE.TrackballControls(camera);
				trackballControls.rotateSpeed = 1.0;
				trackballControls.zoomSpeed = 1.0;
				trackballControls.panSpeed = 1.0;
				trackballControls.noZoom=false;
				trackballControls.noPan=false;
				trackballControls.staticMoving = true;
				trackballControls.dynamicDampingFactor = 1.3;
				var planeGeometry = new THREE.PlaneGeometry(40,20);
				//var planeMaterial = new THREE.MeshBasicMaterial({color:0xcccccc});
				var planeMaterial = new THREE.MeshLambertMaterial({color:0xffffff});//转换对光源有渲染的材质
				var plane = new THREE.Mesh(planeGeometry,planeMaterial);
				plane.rotation.x = -0.5*Math.PI;
				plane.position.x = 15;
				plane.position.y = 0;
				plane.position.x = 0;
				//scene.add(plane);
				plane.receiveShadow  = true;
				//添加材质灯光阴影
				var spotLight1 = new THREE.SpotLight(0xfffff0);
				spotLight1.position.set(-10,20,10);
				spotLight1.castShadow = true;
				scene.add(spotLight1);
				//添加第二个灯
				var spotLight2 = new THREE.SpotLight(0xfffff0);
				spotLight2.position.set(10,-20,-10);
				spotLight2.castShadow = true;
				scene.add(spotLight2);
				
				// model
			    var onProgress = function(xhr) {
			        if (xhr.lengthComputable) {
			            var percentComplete = xhr.loaded / xhr.total * 100;
			            var percent = document.getElementById("percent");
			            percent.innerText = Math.round(percentComplete, 2) + '% 已经加载';
			            setTimeout(function(){
			            	 percent.innerText="";
			            },1000);
			        }
			    };
			    var onError = function(xhr) {};
			    var mtlLoader = new THREE.MTLLoader();
			    mtlLoader.setPath('/assets/libs/3d/');
			    mtlLoader.load('texture.mtl', function(materials) {
			
			        materials.preload();
					//debugger
			        var objLoader = new THREE.OBJLoader();
			        objLoader.setMaterials(materials);
			        //objLoader.setPath('/assets/libs/3d/');
			        //objLoader.load('human-std.obj', function(object) {
			        //debugger
				    objLoader.setPath('/service-tailoring/sys-file/');
			        // objUrl 的值   download?id=123
				    objLoader.load(objUrl, function(object) {
			
			            object.position.y = -14;
			            object.rotation.y = -1.0;
			            //object.scale.set(0.1, 0.1, 0.1);
						object.scale.set(1.5, 1.5, 1.5);
			            scene.add(object);
			
			        }, onProgress, onError);
			    });
				//渲染视图视角
				camera.position.x = -30;
				camera.position.y = 5;
				camera.position.z = 30;
				camera.lookAt(scene.position)
				$("#WebGL-output").append(renderer.domElement)
				renderScene();
				function renderScene(){
					var clock = new THREE.Clock();
		       		var delta = clock.getDelta();
		       		trackballControls.update(delta);
					requestAnimationFrame(renderScene);
					renderer.render(scene,camera);
				}

			};

			// window.render();
		</script>
		
	</body>
</html>
