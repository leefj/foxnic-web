#(authorAndTime)
layui.use(['layer', 'admin', 'form', 'formSelects','upload','foxnic'], function () {
    var layer = layui.layer;
    var admin = layui.admin;
    var form = layui.form;
    var formSelects = layui.formSelects;
	var fox = layui.foxnic;
     
	//模块基础路径
	var moduleURL="#(moduleURL)";
     
    form.render('radio');
    //渲染图片字段
    #for(f : fields)
    #if(f.isImageField) 
    fox.renderSimpleUpload("##(f.varName)","##(f.varName)-button","##(f.varName)-image");
    #end
    #end
    
    
     var formData = admin.getTempData('#(formDataKey)');
     $('##(formId)').attr('method', 'POST');
     if (formData) {
     	form.val('#(formId)', formData);
     	//设置并显示图片
     	#for(f : fields)
	    #if(f.isImageField)
	    if($("##(f.varName)").val()) {
	    	$("##(f.varName)-image").attr("src","/service-tailoring/sys-file/download?id="+$("##(f.varName)").val());
	    }
	    #end
	    #end
     	$('##(formId)').attr('method', 'POST');
     }
     
     
 
 
    // 表单提交事件
    form.on('submit(#(submitButtonId))', function (data) {
    	//debugger;
    	
    	//处理逻辑值
    	#for(f : fields)
	    #if(f.isLogicField) 
	    if(!data.field.#(f.varName)) data.field.#(f.varName)=0;
	    #end
	    #end
    	
    	var api=moduleURL+(data.field.#(pkVarName)?"update":"insert");
        layer.load(2);
        admin.req(api, JSON.stringify(data.field), function (data) {
            layer.closeAll('loading');
            if (data.success) {
                layer.msg(data.message, {icon: 1, time: 500});
                admin.finishPopupCenter();
            } else {
                layer.msg(data.message, {icon: 2, time: 500});
            }
        }, "POST");
        
        return false;
    });
});